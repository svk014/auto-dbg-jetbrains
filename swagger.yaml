openapi: 3.0.3
info:
  title: JetBrains Debugger API
  description: REST API for accessing JetBrains IDE debugger functionality
  version: 0.1.0
  contact:
    name: Auto DBG JetBrains Plugin
    url: https://github.com/svk014/auto-dbg-jetbrains

servers:
  - url: http://localhost:{port}
    description: Local development server
    variables:
      port:
        default: '<add port here>'
        description: Dynamic port assigned by the plugin

paths:
  /api/debugger/frame/{depth}:
    get:
      summary: Get frame information at specific depth
      description: Retrieves frame information from the call stack at the specified depth
      operationId: getFrame
      tags:
        - Frame Operations
      parameters:
        - name: depth
          in: path
          required: true
          description: The depth of the frame in the call stack (0 = current frame)
          schema:
            type: integer
            minimum: 0
            example: 0
      responses:
        '200':
          description: Frame information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Successful frame retrieval
                  value:
                    success: true
                    data:
                      methodName: "calculateSum"
                      lineNumber: 42
                      filePath: "/src/main/java/com/example/Calculator.java"
                    error: null
                    timestamp: 1722556800000
                no_frame:
                  summary: No frame at depth
                  value:
                    success: false
                    data: null
                    error: "No frame available at depth 5"
                    timestamp: 1722556800000
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/debugger/variables/{frameIndex}:
    get:
      summary: Get variables for a specific frame
      description: Retrieves all variables visible in the specified frame
      operationId: getVariables
      tags:
        - Variable Operations
      parameters:
        - name: frameIndex
          in: path
          required: true
          description: The index of the frame to get variables from
          schema:
            type: integer
            minimum: 0
            example: 0
      responses:
        '200':
          description: Variables retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Successful variable retrieval
                  value:
                    success: true
                    data: {}
                    error: null
                    timestamp: 1722556800000
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/debugger/call-stack:
    get:
      summary: Get the current call stack
      description: Retrieves the complete call stack from the debugger
      operationId: getCallStack
      tags:
        - Frame Operations
      responses:
        '200':
          description: Call stack retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Successful call stack retrieval
                  value:
                    success: true
                    data:
                      - methodName: "calculateSum"
                        lineNumber: 42
                        filePath: "/src/main/java/com/example/Calculator.java"
                      - methodName: "processData"
                        lineNumber: 128
                        filePath: "/src/main/java/com/example/DataProcessor.java"
                    error: null
                    timestamp: 1722556800000
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/debugger/breakpoint:
    post:
      summary: Set a breakpoint
      description: Sets a breakpoint at the specified file and line number
      operationId: setBreakpoint
      tags:
        - Breakpoint Operations
      parameters:
        - name: file
          in: query
          required: true
          description: The file path where to set the breakpoint
          schema:
            type: string
            example: "/src/main/java/com/example/Calculator.java"
        - name: line
          in: query
          required: true
          description: The line number where to set the breakpoint
          schema:
            type: integer
            minimum: 1
            example: 42
      responses:
        '200':
          description: Breakpoint set successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Successful breakpoint creation
                  value:
                    success: true
                    data:
                      success: true
                      filePath: "/src/main/java/com/example/Calculator.java"
                      lineNumber: 42
                      condition: null
                      message: "Breakpoint set successfully"
                    error: null
                    timestamp: 1722556800000
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                missing_params:
                  summary: Missing required parameters
                  value:
                    success: false
                    data: null
                    error: "File parameter is required"
                    timestamp: 1722556800000

  /api/debugger/evaluate:
    post:
      summary: Evaluate an expression
      description: Evaluates a code expression in the context of the specified frame
      operationId: evaluateExpression
      tags:
        - Expression Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expression:
                  type: string
                  description: The expression to evaluate
                  example: "count + 1"
                frameIndex:
                  type: integer
                  description: The frame index in which to evaluate the expression
                  default: 0
                  example: 0
      responses:
        '200':
          description: Expression evaluated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Successful evaluation
                  value:
                    success: true
                    data:
                      result: 42
                      expression: "count + 1"
                    error: null
                    timestamp: 1722556800000
        '400':
          description: Bad request - invalid expression
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/debugger/trace_breakpoint:
    post:
      summary: Trace breakpoint hits and evaluate expression
      description: Sets a breakpoint, traces its hits, and evaluates an expression each time the breakpoint is hit.
      operationId: traceBreakpoint
      tags:
        - Breakpoint Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                file:
                  type: string
                  description: The full file path where to set the breakpoint
                  example: "/Users/user1/Documents/personal/SomeJavaProject/src/main/java/com/example/Calculator.java"
                line:
                  type: integer
                  description: The line number where to set the breakpoint
                  example: 42
                breakpointType:
                  type: string
                  description: The type of breakpoint (e.g., LINE)
                  default: "LINE"
                  example: "LINE"
                lambdaOrdinal:
                  type: integer
                  description: Optional lambda ordinal for lambda breakpoints
                  example: 0
                expression:
                  type: string
                  description: The expression to evaluate at each hit
                  example: "count + 1"
                maxHits:
                  type: integer
                  description: Maximum number of hits to trace
                  default: 10
                  example: 10
                timeoutMs:
                  type: integer
                  description: Timeout in milliseconds for each hit
                  default: 30000
                  example: 30000
      responses:
        '200':
          description: Trace completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: Trace completed
                  value:
                    success: true
                    data:
                      hits: 3
                      traces:
                        - hitNumber: 1
                          location: "/src/main/java/com/example/Calculator.java:42"
                          frameIndex: 0
                          expressionResult: 43
                        - hitNumber: 2
                          location: "/src/main/java/com/example/Calculator.java:42"
                          frameIndex: 0
                          expressionResult: 44
                        - hitNumber: 3
                          location: "/src/main/java/com/example/Calculator.java:42"
                          frameIndex: 0
                          expressionResult: 45
                      breakpointRemoved: true
                    error: null
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  schemas:
    ApiResponse:
      type: object
      description: Generic API response wrapper
      required:
        - success
        - timestamp
      properties:
        success:
          type: boolean
          description: Indicates if the operation was successful
          example: true
        data:
          nullable: true
          description: The response data (null on error)
        error:
          type: string
          nullable: true
          description: Error message (null on success)
          example: null
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp when the response was generated
          example: 1722556800000

    FrameResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              nullable: true
              allOf:
                - $ref: '#/components/schemas/FrameInfo'

    CallStackResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              nullable: true
              type: array
              items:
                $ref: '#/components/schemas/FrameInfo'

    BreakpointResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              nullable: true
              allOf:
                - $ref: '#/components/schemas/BreakpointInfo'

    VariablesResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              nullable: true
              type: object
              additionalProperties: true
              description: Variable data as key-value pairs

    BreakpointInfo:
      type: object
      description: Information about a debugger breakpoint
      required:
        - success
        - filePath
        - lineNumber
        - message
      properties:
        success:
          type: boolean
          description: Whether the breakpoint operation was successful
          example: true
        filePath:
          type: string
          description: The file path of the breakpoint
          example: "/src/main/java/com/example/Calculator.java"
        lineNumber:
          type: integer
          minimum: 1
          description: The line number of the breakpoint
          example: 42
        condition:
          type: string
          nullable: true
          description: Optional condition for the breakpoint
          example: "count > 10"
        message:
          type: string
          description: Status message about the breakpoint operation
          example: "Breakpoint set successfully"

    FrameInfo:
      type: object
      description: Information about a stack frame
      required:
        - methodName
        - lineNumber
        - filePath
      properties:
        methodName:
          type: string
          description: Name of the method in this frame
          example: "calculateSum"
        lineNumber:
          type: integer
          description: Current line number in the frame
          example: 42
        filePath:
          type: string
          description: Full path to the source file
          example: "/src/main/java/com/example/Calculator.java"

    OperationResult:
      type: object
      description: Result of a generic operation
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        message:
          type: string
          description: Description of the operation result
          example: "Operation completed successfully"
        details:
          type: object
          additionalProperties:
            type: string
          description: Additional details about the operation
          example: {}

tags:
  - name: Frame Operations
    description: Operations related to stack frames
  - name: Variable Operations
    description: Operations for accessing variable values
  - name: Breakpoint Operations
    description: Operations for managing breakpoints
  - name: Expression Operations
    description: Operations for evaluating expressions
